<div class="sidebar">
  {{$currentNode := .}}
  <nav class="slide-menu" aria-labelledby="table-of-contents">
  <h2 id="table-of-contents" class="sr-only">Table Of Contents</h2>
  <ul>
  <li class="{{ if .IsHome }}active{{ end }}"><a href="{{ .Site.BaseURL }}">Home</a></li>
  {{- range .Site.Home.Sections.ByWeight -}}
    {{template "slide-menu" dict "sect" . "currentnode" $currentNode}}
  {{- end -}}
  </ul>
  </nav>
</div>

{{define "slide-menu"}}
  {{- $currentNode := .currentnode -}}
  {{ with .sect }}
    {{ if .IsSection }}
      {{- safeHTML .Params.head -}}
      {{- $hasPages := or .Pages .Sections -}}
      <li class="
        {{- if .IsAncestor $currentNode }} parent{{ end -}}
        {{- if and .File $currentNode.File -}}
          {{- if eq .File.UniqueID $currentNode.File.UniqueID }} active{{ end -}}
        {{- end -}}
        {{- if $hasPages }} has-sub-menu{{ end -}}
      ">
        <a href="{{ .Permalink }}">
          {{- .Title -}}
          {{- if $hasPages -}}
            {{- if .IsAncestor $currentNode -}}
              <span class="mark opened">-</span>
            {{- else -}}
              <span class="mark closed">+</span>
            {{- end -}}
          {{- end -}}
        </a>
        {{ if $hasPages }}
          <ul class="sub-menu">
            {{- .Scratch.Set "pages" .Pages -}}
            {{- if .Sections -}}
              {{- .Scratch.Set "pages" (.Pages | union .Sections) -}}
            {{- end -}}
            {{- $pages := (.Scratch.Get "pages") -}}
            {{- range $pages.ByWeight -}}
              {{template "slide-menu" dict "sect" . "currentnode" $currentNode}}
            {{- end -}}
          </ul>
        {{end}}
      </li>
    {{- else -}}
      <li class="
        {{- if and .File $currentNode.File -}}
          {{- if eq .File.UniqueID $currentNode.File.UniqueID }}active{{ end -}}
        {{- end -}}
      ">
        <a href="{{ .Permalink }}">{{ .Title }}</a>
      </li>
    {{ end -}}
  {{ end -}}
{{ end }}
