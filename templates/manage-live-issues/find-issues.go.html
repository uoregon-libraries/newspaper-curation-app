{{block "content" .}}

<div class="card">
  <div class="card-header">
    <h2><button class="link disclosure" data-widget="simple-disclosure" aria-expanded="false" aria-controls="filter-form-wrapper">Filters</button></h2>
  </div>
  <div class="disclosure card-body" id="filter-form-wrapper">
    <form id="filter-form" role="form" data-url="{{.Data.SearchURL}}">

      <div class="row mb-3">
        <label class="col-md-2 col-form-label" for="url">Production URL</label>
        <div class="col-md-10">
          <input class="form-control" type="text" id="url" name="url" autocomplete="off" aria-describedby="url-help" pattern="https?://[^\/]+/lccn/[a-z0-9]{10}/?(\d\d\d\d-\d\d-\d\d/.*)?" />
          <div id="url-help" class="form-text">
            <p>
              Enter a URL to a production issue or title.
            </p>

            <p>
              The URL must be a standard ONI title, issue, or page URL:
              <ul>
                <li><code>https://oregonnews.uoregon.edu/lccn/sn12345678</code> would filter by the title with "sn12345678" as its LCCN</li>
                <li><code>https://oregonnews.uoregon.edu/lccn/sn12345678/2006-01-02/ed-1/seq-1/</code> would filter for the issue of "sn12345678" published on Jan 1, 2006.</li>
                <li>Technical: the rule is that the path must start with "/lccn", followed by the LCCN, and optionally an issue date. Anything after the issue date is ignored.</li>
              </ul>
            </p>
          </div>
        </div>
      </div>

      <div class="row mb-3">
        <label class="col-md-2 col-form-label" for="lccn">LCCN</label>
        <div class="col-md-4">
          <input class="form-control" list="titles" id="lccn" name="lccn" autocomplete="off" aria-describedby="lccn-help" />
          <div id="lccn-help" class="form-text">
            Enter an LCCN. You may start typing a title's LCCN or its name, and
            on selection the appropriate LCCN will be set.
          </div>
        </div>
        <datalist id="titles">
          {{range .Data.Titles}}
          <option value="{{.LCCN}}">{{.Name}} - {{.LCCN}}</option>
          {{end}}
        </datalist>

        <label class="col-md-2 col-form-label" for="pubdate">Published On</label>
        <div class="col-md-4">
          <input class="form-control" type="text" id="pubdate" name="pubdate" aria-describedby="pubdate-help" pattern="(\d\d\d\d)(-\d\d)?(-\d\d)?" />
          <div id="pubdate-help" class="form-text">
            Enter the publication year, year + month, or year + month + day in
            the form "YYYY", "YYYY-MM", or "YYYY-MM-DD", respectively.
          </div>
        </div>
      </div>

      <div class="row mb-3">
        <label class="col-md-2 col-form-label" for="moc">MARC Org Code</label>
        <div class="col-md-4">
          <input class="form-control" list="mocs" id="moc" name="moc" autocomplete="off" aria-describedby="moc-help" />
          <div id="moc-help" class="form-text">
            Enter a MARC Org Code. You may start typing a code or its name, and
            on selection the appropriate code will be set.
          </div>
        </div>
        <datalist id="mocs">
          {{range .Data.MOCs}}
          <option value="{{.Code}}">{{if .Name}}{{.Name}} - {{end}}{{.Code}}</option>
          {{end}}
        </datalist>

        <label class="col-md-2 col-form-label" for="went-live">Went Live Up To...</label>
        <div class="col-md-4">
          <select class="form-select" id="went-live" name="went-live" autocomplete="off" aria-describedby="went-live-days-ago-help">
            <option value="">Anytime</option>
            <option value="1W">1 week ago</option>
            <option value="2W">2 weeks ago</option>
            <option value="1M">1 month ago</option>
            <option value="3M">3 months ago</option>
            <option value="6M">6 months ago</option>
            <option value="1Y">1 year ago</option>
          </select>
          <div id="went-live-help" class="form-text">
            Find issues based on how recently they went live.
          </div>
        </div>
      </div>

      <div class="row mb-3">
        <div class="offset-md-2 col-md-4">
          <button class="btn btn-primary" type="Submit">Apply</button>
          <button class="btn btn-outline" type="Reset" id="clear-filters">Clear Filters</button>
        </div>

        <div class="col-md-6">
          <div id="json-status" role="status" class="alert inline" data-faded="true" aria-live="polite">Status: N/A</div>
        </div>
      </div>

    </form>
  </div> <!-- card body -->
</div> <!-- card -->

<!-- Search Results Section -->
<div class="row mt-4">
  <div class="col"> <!-- Full width column -->
    <h2>Search Results</h2>
    <p>
      After filtering is applied, search results will appear below. Notes:
      <ul>
        <li>
          The issues will only include those which NCA ingested: other sources
          of Open ONI content are not indexed.
        </li>
        <li>
          All links in the table take you to the production site.
        </li>
      </ul>
    </p>
    <div id="search-results">
      <p id="search-results-message"><em>Use the filters above to search for issues.</em></p>
      <table id="search-results-table" class="table table-striped table-bordered mt-3" data-queue-removal-url="{{.Data.QueueRemovalURL}}" style="display: none;">
        <caption>Search results</caption>
        <thead>
          <tr>
            <th scope="col">Title</th>
            <th scope="col">Issue</th>
            <th scope="col">Batch</th>
            <th scope="col">Went Live</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Rows will be injected here by JavaScript -->
        </tbody>
      </table>
    </div>
  </div>
</div>

{{end}}

{{block "extrajs" .}}
  {{IncludeJS "manage-live-issues"}}
{{end}}
