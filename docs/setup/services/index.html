<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Services and Apps - Newspaper Curation App</title>
<meta name="description" content="The services in the NCA suite">
<meta name="generator" content="Hugo 0.117.0">
<link rel="canonical" href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/services/">
<link rel="stylesheet" href="https://uoregon-libraries.github.io/newspaper-curation-app/css/theme.css">
<link rel="stylesheet" href="https://uoregon-libraries.github.io/newspaper-curation-app/css/chroma.css">
<link rel="stylesheet" href="https://uoregon-libraries.github.io/newspaper-curation-app/css/treeview-navigation.css">
<script src="https://uoregon-libraries.github.io/newspaper-curation-app/js/headerlink.js"></script>
<script src="https://uoregon-libraries.github.io/newspaper-curation-app/js/treeview-navigation.js"></script><meta property="og:title" content="Services and Apps" />
<meta property="og:description" content="The services in the NCA suite" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://uoregon-libraries.github.io/newspaper-curation-app/setup/services/" /><meta property="article:section" content="setup" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Services and Apps"/>
<meta name="twitter:description" content="The services in the NCA suite"/>
<meta itemprop="name" content="Services and Apps">
<meta itemprop="description" content="The services in the NCA suite">

<meta itemprop="wordCount" content="1077">
<meta itemprop="keywords" content="" /></head>
<body>
  <div class="container"><div class="skip"><a href="#maincontent">Skip to main content</a></div>
<header>
<h1>Newspaper Curation App</h1><a href="https://github.com/uoregon-libraries/newspaper-curation-app/" class="github"><img src="https://uoregon-libraries.github.io/newspaper-curation-app/images/github-mark-white.svg" alt="NCA on Github"></a>
</header>
<div class="content-container"><div class="sidebar">
  
  <nav aria-labelledby="table-of-contents">
    <h2 id="table-of-contents" class="sr-only">Table Of Contents</h2>
    <ul class="treeview-navigation" role="tree" aria-label="Contents">
      <li role="none">
        <a role="treeitem"  href="https://uoregon-libraries.github.io/newspaper-curation-app/">
          <span class="label">Home</span>
        </a>
      </li><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/"
        aria-owns="subtree--newspaper-curation-app-setup-"
          aria-expanded="true">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>Setup and Installation
        </span>
      </a><ul role="group" aria-label="Setup and Installation" id="subtree--newspaper-curation-app-setup-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/services/"
        aria-current="page"
        >
        <span class="label">Services and Apps
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/server-setup/"
        >
        <span class="label">Server Setup
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/installation/"
        >
        <span class="label">Installation
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/user-setup/"
        >
        <span class="label">Users
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/creating-publishers/"
        >
        <span class="label">Onboarding A Publisher
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/sftpgo-integration/"
        >
        <span class="label">SFTPGo Integration
        </span>
      </a></li>
  </ul></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/"
        aria-owns="subtree--newspaper-curation-app-specs-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>NCA Terms, Specs, and Information
        </span>
      </a><ul role="group" aria-label="NCA Terms, Specs, and Information" id="subtree--newspaper-curation-app-specs-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/glossary/"
        >
        <span class="label">Glossary
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/upload-specs/"
        >
        <span class="label">Uploads: Folder and File Specs
        </span>
      </a></li>
  </ul></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/"
        aria-owns="subtree--newspaper-curation-app-workflow-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>Workflow
        </span>
      </a><ul role="group" aria-label="Workflow" id="subtree--newspaper-curation-app-workflow-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/technical/"
        >
        <span class="label">Technical Details
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/adding-titles/"
        >
        <span class="label">Adding Titles
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/handling-page-review-problems/"
        >
        <span class="label">Handling Page Review Problems
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-stuck-issues/"
        >
        <span class="label">Fixing &#34;Stuck&#34; Issues
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-flagged-workflow-issues/"
        >
        <span class="label">Fixing Flagged Workflow Issues
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-live-batches/"
        >
        <span class="label">Replacing Live Issues
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/undo-batch-golive/"
        >
        <span class="label">&#34;Un-push&#34; Batch From Production
        </span>
      </a></li>
  </ul></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/"
        aria-owns="subtree--newspaper-curation-app-contributing-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>Contributing
        </span>
      </a><ul role="group" aria-label="Contributing" id="subtree--newspaper-curation-app-contributing-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-guide/"
        >
        <span class="label">Developer&#39;s Guide
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/not-compiling-locally/"
        >
        <span class="label">Not Compiling Locally
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/documentation/"
        >
        <span class="label">Contributing to Documentation
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/testing/"
        >
        <span class="label">Testing
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-howto/"
        aria-owns="subtree--newspaper-curation-app-contributing-dev-howto-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>How do I...?
        </span>
      </a><ul role="group" aria-label="How do I...?" id="subtree--newspaper-curation-app-contributing-dev-howto-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-howto/add-job-types/"
        >
        <span class="label">Add Job Types
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-howto/add-config-items/"
        >
        <span class="label">Add Configuration Settings
        </span>
      </a></li>
  </ul></li>
  </ul></li>
  </ul>
  </nav>
</div>


<main id="maincontent"><h1>Services and Apps</h1><p>You should at least understand everything in this document at a high level
before moving on to the setup/installation documents, as the NCA suite is a set
of tools, not a single application that does it all.</p>
<h2 id="overview">Overview</h2>
<p>NCA has two key services which you&rsquo;ll have to have running in the background at
all times, several binaries you&rsquo;ll need to use occasionally for regular tasks,
and of course the various external services (such as a IIIF server, SFTP
server, MySQL / MariaDB, Apache / nginx, etc.).</p>
<p>The docker setup is by far the easiest to get running, but hasn&rsquo;t been given a
ton of attention in terms of production usability. If you need stability, a
manual installation is recommended. Manual installations are easiest to
reverse-engineer by reading the various docker files to see what you need to
install, and potentially how to install it.</p>
<p><strong>Note</strong>: If you do go manual, the repository contains working examples for
systemd services to start the job runner as well as the workflow http
server: <a href="https://github.com/uoregon-libraries/newspaper-curation-app/tree/main/deploy">https://github.com/uoregon-libraries/newspaper-curation-app/tree/main/deploy</a>.
Consider looking at these to better understand how you might manage a
production installation.</p>
<h2 id="http-server">HTTP Server</h2>
<p><code>server</code> is the web server which exposes all of NCA&rsquo;s workflow UI. Please
note that, at the moment, this requires Apache sitting in front of the server
for authentication.</p>
<p>Running this is fairly simple once settings are configured:</p>
<pre><code>/usr/local/nca/server -c /usr/local/nca/settings
</code></pre>
<h3 id="gotcha">Gotcha</h3>
<p><strong>NOTE</strong>: <code>server</code> builds a cache of issues and regularly rescans the
filesystem and the live site to keep its cache nearly real-time for almost
instant lookups of issue data. However, building this cache requires the live
site to use the same JSON endpoints chronam uses.</p>
<p>ONI&rsquo;s JSON endpoints were rewritten to use IIIF, so out of the box, ONI isn&rsquo;t
compatible with this cache-building system. The IIIF endpoints supply very
generic information, which didn&rsquo;t give us issue-level information without
performing thousands of additional HTTP requests, so we had to put the old JSON
responses back into our app. If you wish to use this application with an ONI
install, you&rsquo;ll need to do something similar.</p>
<p>The relevant commit links follow:</p>
<ul>
<li><a href="https://github.com/uoregon-libraries/oregon-oni/commit/067ab17084d9015996932d2e001226aa18bbcdb6">Override IIIF JSON endpoints with previous JSON</a></li>
<li><a href="https://github.com/uoregon-libraries/oregon-oni/commit/0463435615b23058ca1bc2afd8017e7001dc0657">Fix batch JSON pagination</a></li>
<li><a href="https://github.com/uoregon-libraries/oregon-oni/commit/94f84a30abd6ad5a38c8bd932a95297e1a9b1989">Fix missing route name</a></li>
</ul>
<h2 id="job-runner">Job Runner</h2>
<p>Queued jobs (such as SFTP issues manually reviewed and queued) will not be
processed until the job runner is executed.</p>
<p>The best way to run jobs is via the &ldquo;watchall&rdquo; subcommand:</p>
<pre><code>./bin/run-jobs -c ./settings watchall
</code></pre>
<p>This starts the job runner, which will watch all queues and run jobs as they
come in. When invoked this way, the job runner will simply run forever to
ensure jobs are processed whenever there&rsquo;s work to be done.</p>
<p>If you only want to drain all pending jobs and then quit, you can add
<code>--exit-when-done</code> to the command.</p>
<p>Finally, there&rsquo;s a subcommand to run a single job and then exit:</p>
<pre><code>./bin/run-jobs -c ./settings run-one
</code></pre>
<p>This is primarily a development tool for debugging long pipelines where a
single job seems to be breaking app state, but it can be used to also very
closely monitor exactly which jobs are running in what order, if such a need
should arise.</p>
<h2 id="batch-queue">Batch Queue</h2>
<p>The queue-batches tool is currently run manually. Until more of the batch
ingest can be automated, it is safest to require somebody to manually watch the
process which tries to gather up issues into a batch. This can of course be
set up to run on cron if so desired.</p>
<p>Execution is simple:</p>
<pre><code>./bin/queue-batches -c ./settings
</code></pre>
<p>The job runner will do the rest of the work, eventually putting batches into
your configured <code>BATCH_OUTPUT_PATH</code> and syncing to the <code>BATCH_PRODUCTION_PATH</code>.
The batch status page in NCA will show which batches have finished processing
and are ready for ingest into staging.</p>
<p>The tool can be given flags for <code>--min-batch-size</code> and <code>--max-batch-size</code> in
order to override the standard settings, e.g., if you need cronned batch
generation to behave differently than manual runs.</p>
<h2 id="bulk-upload-queue">Bulk Upload Queue</h2>
<p>The <code>bulk-issue-queue</code> tool allows you to push uploaded issues into the
workflow in bulk. This should <em>only</em> be used when you have some other
validation step that happens to the issues of the given type (born digital or
scanned), otherwise you may find a lot of errors that require manual
intervention of issues in the workflow, which is always more costly than
catching problems prior to queueing.</p>
<p>Sample usage:</p>
<pre><code>./bin/bulk-issue-queue -c ./settings --type scan --key sn12345678
</code></pre>
<p>Run without arguments for a more full description of options</p>
<h2 id="live-file-cleanup">Live File Cleanup</h2>
<p><code>delete-live-done-issues</code> is a tool which removes all files NCA tracks after
their corresponding batch has been marked &ldquo;archived&rdquo; for four weeks (to ensure
it&rsquo;s safe to remove them). This should be run regularly to prevent disk space
exhaustion - holding onto hundreds of gigs of TIFFs that are backed up outside
NCA, for instance.</p>
<h2 id="database-migration">Database Migration</h2>
<p>To simplify database table creation / updating, the <code>migrate-database</code> binary
is provided. We&rsquo;ll generally mention in the release notes / changelog that a
version requires database migrations and give the example command to run this,
so it isn&rsquo;t typically something you would run on your own, but it&rsquo;s also
harmless if you do run it manually - it won&rsquo;t re-run any database update
scripts that have already run.</p>
<h2 id="purge-dead-issues">Purge Dead Issues</h2>
<p><code>purge-dead-issues</code> is useful to move all &ldquo;stuck&rdquo; issues out of NCA and into
the configured problem folder. The original files will be moved, and the full
activity log stored as a text file to help identify how to fix whatever problem
prevented curators (or NCA job runners) from processing an issue.</p>
<h2 id="other-tools">Other Tools</h2>
<p>You&rsquo;ll find a lot of other tools in <code>bin</code> after compiling NCA. Most
have some kind of useful help, so feel free to give them a try, but they won&rsquo;t
be documented in depth. Most are one-offs to help diagnose problems or test
features, and shouldn&rsquo;t be necessary for regular use of this software.</p>
<h2 id="iiif-image-server">IIIF Image Server</h2>
<p>A IIIF server is not included (and it wouldn&rsquo;t make sense to couple into every
app that needs to show images). However, in order to use NCA to see newspaper
pages, you will need a IIIF server of some kind.</p>
<p><a href="https://github.com/uoregon-libraries/rais-image-server">RAIS</a> is the
recommended image server: it&rsquo;s easy to install and run, and it handles JP2s
without any special configuration.</p>
<p>A simple invocation can be done by using the NCA settings file, since
it is compatible with bash, and has all the settings RAIS needs:</p>
<pre><code>source /path/to/nca/settings
/path/to/rais-server --address &quot;:12415&quot; \
    --tile-path $WORKFLOW_PATH \
    --iiif-url &quot;$IIIF_BASE_URL&quot; \
    --log-level INFO
</code></pre>
<nav class="pagination" aria-label="Pagination">

  <a class="nav nav-prev" href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/">← Prev - Setup and Installation</a>

  <a class="nav nav-next" href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/server-setup/">Next - Server Setup →</a></nav>
<footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>.
</footer>
      </main>
    </div>

  </div>
</body>
</html>
