<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Replacing Live Issues - Newspaper Curation App</title>
<meta name="description" content="Fixing batches after they&#39;ve been pushed into production">
<meta name="generator" content="Hugo 0.117.0">
<link rel="canonical" href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-live-batches/">
<link rel="stylesheet" href="https://uoregon-libraries.github.io/newspaper-curation-app/css/theme.css">
<link rel="stylesheet" href="https://uoregon-libraries.github.io/newspaper-curation-app/css/chroma.css">
<link rel="stylesheet" href="https://uoregon-libraries.github.io/newspaper-curation-app/css/treeview-navigation.css">
<script src="https://uoregon-libraries.github.io/newspaper-curation-app/js/headerlink.js"></script>
<script src="https://uoregon-libraries.github.io/newspaper-curation-app/js/treeview-navigation.js"></script><meta property="og:title" content="Replacing Live Issues" />
<meta property="og:description" content="Fixing batches after they&#39;ve been pushed into production" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-live-batches/" /><meta property="article:section" content="workflow" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Replacing Live Issues"/>
<meta name="twitter:description" content="Fixing batches after they&#39;ve been pushed into production"/>
<meta itemprop="name" content="Replacing Live Issues">
<meta itemprop="description" content="Fixing batches after they&#39;ve been pushed into production">

<meta itemprop="wordCount" content="564">
<meta itemprop="keywords" content="" /></head>
<body>
  <div class="container"><div class="skip"><a href="#maincontent">Skip to main content</a></div>
<header>
<h1>Newspaper Curation App</h1><a href="https://github.com/uoregon-libraries/newspaper-curation-app/" class="github"><img src="https://uoregon-libraries.github.io/newspaper-curation-app/images/github-mark-white.svg" alt="NCA on Github"></a>
</header>
<div class="content-container"><div class="sidebar">
  
  <nav aria-labelledby="table-of-contents">
    <h2 id="table-of-contents" class="sr-only">Table Of Contents</h2>
    <ul class="treeview-navigation" role="tree" aria-label="Contents">
      <li role="none">
        <a role="treeitem"  href="https://uoregon-libraries.github.io/newspaper-curation-app/">
          <span class="label">Home</span>
        </a>
      </li><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/"
        aria-owns="subtree--newspaper-curation-app-setup-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>Setup and Installation
        </span>
      </a><ul role="group" aria-label="Setup and Installation" id="subtree--newspaper-curation-app-setup-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/services/"
        >
        <span class="label">Services and Apps
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/server-setup/"
        >
        <span class="label">Server Setup
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/installation/"
        >
        <span class="label">Installation
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/user-setup/"
        >
        <span class="label">Users
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/creating-publishers/"
        >
        <span class="label">Onboarding A Publisher
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/sftpgo-integration/"
        >
        <span class="label">SFTPGo Integration
        </span>
      </a></li>
  </ul></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/"
        aria-owns="subtree--newspaper-curation-app-specs-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>NCA Terms, Specs, and Information
        </span>
      </a><ul role="group" aria-label="NCA Terms, Specs, and Information" id="subtree--newspaper-curation-app-specs-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/glossary/"
        >
        <span class="label">Glossary
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/upload-specs/"
        >
        <span class="label">Uploads: Folder and File Specs
        </span>
      </a></li>
  </ul></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/"
        aria-owns="subtree--newspaper-curation-app-workflow-"
          aria-expanded="true">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>Workflow
        </span>
      </a><ul role="group" aria-label="Workflow" id="subtree--newspaper-curation-app-workflow-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/technical/"
        >
        <span class="label">Technical Details
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/adding-titles/"
        >
        <span class="label">Adding Titles
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/handling-page-review-problems/"
        >
        <span class="label">Handling Page Review Problems
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-stuck-issues/"
        >
        <span class="label">Fixing &#34;Stuck&#34; Issues
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-flagged-workflow-issues/"
        >
        <span class="label">Fixing Flagged Workflow Issues
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-live-batches/"
        aria-current="page"
        >
        <span class="label">Replacing Live Issues
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/undo-batch-golive/"
        >
        <span class="label">&#34;Un-push&#34; Batch From Production
        </span>
      </a></li>
  </ul></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/"
        aria-owns="subtree--newspaper-curation-app-contributing-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>Contributing
        </span>
      </a><ul role="group" aria-label="Contributing" id="subtree--newspaper-curation-app-contributing-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-guide/"
        >
        <span class="label">Developer&#39;s Guide
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/not-compiling-locally/"
        >
        <span class="label">Not Compiling Locally
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/documentation/"
        >
        <span class="label">Contributing to Documentation
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/testing/"
        >
        <span class="label">Testing
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-howto/"
        aria-owns="subtree--newspaper-curation-app-contributing-dev-howto-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>How do I...?
        </span>
      </a><ul role="group" aria-label="How do I...?" id="subtree--newspaper-curation-app-contributing-dev-howto-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-howto/add-job-types/"
        >
        <span class="label">Add Job Types
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-howto/add-config-items/"
        >
        <span class="label">Add Configuration Settings
        </span>
      </a></li>
  </ul></li>
  </ul></li>
  </ul>
  </nav>
</div>


<main id="maincontent"><h1>Replacing Live Issues</h1><h2 id="helper-script">Helper Script</h2>
<p>We&rsquo;ve put together a helper script which can automate a lot of the preparation
steps when a single LCCN needs a lot of issues pulled. It is hacky and
hard-coded at the moment, but it doesn&rsquo;t make any changes to anything, so it&rsquo;s
safe to try out, and even modify to suit other use-cases.</p>
<p>To run: <code>go run scripts/help-remove-issues.go &lt;lccn&gt; &lt;issue dates filename&gt; &lt;path to NCA dir&gt; &lt;path to live batches&gt;</code>.</p>
<p>This will find all batches that have the given LCCN and dates. It will &ldquo;parse&rdquo;
date ranges that are in the form &ldquo;YYYY-MM-DD thru YYYY-MM-DD&rdquo; and then find all
valid issues within that range.</p>
<p>It will then produce a complete list of all commands you&rsquo;ll need to run.</p>
<h3 id="preparation">Preparation</h3>
<ul>
<li>Create a file full of dates in the form <code>YYYY-MM-DD</code>, representing all dates
which need to be pulled
<ul>
<li>Note that <strong>all</strong> editions on the given date will be removed</li>
</ul>
</li>
<li>Grab <a href="https://github.com/uoregon-libraries/batch-issue-remover">https://github.com/uoregon-libraries/batch-issue-remover</a> and build it.
Copy the binary to your NCA system, as it is presumably capable of writing to
your batch dir&hellip; otherwise how would you build batches?</li>
<li>Determine where you&rsquo;ll run this script so you can put all necessary helper
binaries in place
<ul>
<li>You need <code>find-issues</code> (from a standard NCA project build) and
<code>remove-issues</code> (from the above-mentioned batch issue remove repo) under a
<code>bin</code> directory in your NCA dir
<ul>
<li>e.g., if your NCA installation is in <code>/usr/local/nca</code>, that&rsquo;s your &ldquo;path
to NCA dir&rdquo;, and you&rsquo;ll need to place the binaries in
<code>/usr/local/nca/bin</code>.</li>
</ul>
</li>
</ul>
</li>
<li>Run the helper, e.g., <code>go run scripts/help-remove-issues.go sn12345678 /tmp/issue-dates /usr/local/nca /mnt/livebatches</code>
<ul>
<li>You probably want to capture the output to a file</li>
</ul>
</li>
</ul>
<h3 id="removal">Removal</h3>
<p>The output of the helper script has three components:</p>
<ul>
<li>Removal / rebatch commands using <code>remove-issues</code>. Each of these commands will
generate a new version of a live batch with the given issue keys removed.
This is a non-destructive operation, as the live batch isn&rsquo;t changed, and the
new version could simply be deleted if desired without any effect.</li>
<li>Purge / load batch commands. These pair up for each new batch generated: you
purge the live batch, then load the new one which has the bad issues removed.
These commands are destructive but can still be undone because you can simply
reverse them if necessary: purge the new version of the batch and then load
the old one.</li>
<li>Batch destruction commands. These are very permanent, and will dispose of the
old version of batches, which you no presumably no longer want living
alongside the new version.</li>
</ul>
<p>At UO, we also have a separate component we try to manage, which is a &ldquo;batch
patch&rdquo; for our dark archive. For each change to a batch that&rsquo;s been archived,
we craft a README.md with the commands needed, and generally include the entire
codebase of any commands we use in order to ensure reproducibility. This is
manual and error-prone, but necessary to ensure disaster recovery efforts will
not result in loading old/broken batches we&rsquo;ve since fixed.</p>
<h2 id="post-fix">Post-fix</h2>
<p>Once you&rsquo;ve ingested the new issues, NCA needs to have its cache completely
rebuilt, since it assumes what&rsquo;s live doesn&rsquo;t change (it does a full rebuild
weekly, but this is often too slow for heavy workflows).</p>
<ul>
<li>Stop the NCA services (nca-httpd and nca-workers)</li>
<li>Delete the NCA cache entirely
<ul>
<li>e.g., if <code>$ISSUE_CACHE_PATH</code> is <code>/tmp</code>: <code>rm -rf /tmp/batch-list /tmp/batches /tmp/titles /tmp/finder.cache</code></li>
</ul>
</li>
<li>Start the services up. This will take time as the live site has to be re-scanned</li>
</ul>
<nav class="pagination" aria-label="Pagination">

  <a class="nav nav-prev" href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-flagged-workflow-issues/">← Prev - Fixing Flagged Workflow Issues</a>

  <a class="nav nav-next" href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/undo-batch-golive/">Next - &#34;Un-push&#34; Batch From Production →</a></nav>
<footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>.
</footer>
      </main>
    </div>

  </div>
</body>
</html>
