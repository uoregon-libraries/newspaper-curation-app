<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Workflow - Newspaper Curation App</title>
<meta name="description" content="Explanation of NCA&#39;s various workflows">
<meta name="generator" content="Hugo 0.147.5">
<link rel="canonical" href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/">
<link rel="stylesheet" href="https://uoregon-libraries.github.io/newspaper-curation-app/css/theme.css">
<link rel="stylesheet" href="https://uoregon-libraries.github.io/newspaper-curation-app/css/chroma.css">
<link rel="stylesheet" href="https://uoregon-libraries.github.io/newspaper-curation-app/css/treeview-navigation.css">
<script src="https://uoregon-libraries.github.io/newspaper-curation-app/js/headerlink.js"></script>
<script src="https://uoregon-libraries.github.io/newspaper-curation-app/js/treeview-navigation.js"></script><meta property="og:url" content="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/">
  <meta property="og:site_name" content="Newspaper Curation App">
  <meta property="og:title" content="Workflow">
  <meta property="og:description" content="Explanation of NCA&#39;s various workflows">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="website">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Workflow">
  <meta name="twitter:description" content="Explanation of NCA&#39;s various workflows">

  <meta itemprop="name" content="Workflow">
  <meta itemprop="description" content="Explanation of NCA&#39;s various workflows">
  <meta itemprop="wordCount" content="821"></head>
<body>
  <div class="container"><div class="skip"><a href="#maincontent">Skip to main content</a></div>
<header>
<h1>Newspaper Curation App</h1><a href="https://github.com/uoregon-libraries/newspaper-curation-app/" class="github"><img src="https://uoregon-libraries.github.io/newspaper-curation-app/images/github-mark-white.svg" alt="NCA on Github"></a>
</header>
<div class="content-container"><div class="sidebar">
  
  <nav aria-labelledby="table-of-contents">
    <h2 id="table-of-contents" class="sr-only">Table Of Contents</h2>
    <ul class="treeview-navigation" role="tree" aria-label="Contents">
      <li role="none">
        <a role="treeitem"  href="https://uoregon-libraries.github.io/newspaper-curation-app/">
          <span class="label">Home</span>
        </a>
      </li><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/"
        aria-owns="subtree--newspaper-curation-app-setup-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>Setup and Installation
        </span>
      </a><ul role="group" aria-label="Setup and Installation" id="subtree--newspaper-curation-app-setup-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/services/"
        >
        <span class="label">Services and Apps
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/server-setup/"
        >
        <span class="label">Server Setup
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/installation/"
        >
        <span class="label">Installation
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/user-setup/"
        >
        <span class="label">Users
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/creating-publishers/"
        >
        <span class="label">Onboarding A Publisher
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/sftpgo-integration/"
        >
        <span class="label">SFTPGo Integration
        </span>
      </a></li>
  </ul></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/"
        aria-owns="subtree--newspaper-curation-app-specs-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>NCA Terms, Specs, and Information
        </span>
      </a><ul role="group" aria-label="NCA Terms, Specs, and Information" id="subtree--newspaper-curation-app-specs-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/glossary/"
        >
        <span class="label">Glossary
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/upload-specs/"
        >
        <span class="label">Uploads: Folder and File Specs
        </span>
      </a></li>
  </ul></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/"
        aria-current="page"
        aria-owns="subtree--newspaper-curation-app-workflow-"
          aria-expanded="true">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>Workflow
        </span>
      </a><ul role="group" aria-label="Workflow" id="subtree--newspaper-curation-app-workflow-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/technical/"
        >
        <span class="label">Technical Details
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/adding-titles/"
        >
        <span class="label">Adding Titles
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/handling-page-review-problems/"
        >
        <span class="label">Handling Page Review Problems
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-stuck-issues/"
        >
        <span class="label">Fixing &#34;Stuck&#34; Issues
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-flagged-workflow-issues/"
        >
        <span class="label">Fixing Flagged Workflow Issues
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/fixing-live-batches/"
        >
        <span class="label">Replacing Live Issues
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/undo-batch-golive/"
        >
        <span class="label">&#34;Un-push&#34; Batch From Production
        </span>
      </a></li>
  </ul></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/"
        aria-owns="subtree--newspaper-curation-app-contributing-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>Contributing
        </span>
      </a><ul role="group" aria-label="Contributing" id="subtree--newspaper-curation-app-contributing-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-guide/"
        >
        <span class="label">Developer&#39;s Guide
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/not-compiling-locally/"
        >
        <span class="label">Not Compiling Locally
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/documentation/"
        >
        <span class="label">Contributing to Documentation
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/testing/"
        >
        <span class="label">Testing
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-howto/"
        aria-owns="subtree--newspaper-curation-app-contributing-dev-howto-"
          aria-expanded="false">
        <span class="label"><span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24">
              <polygon points="2,3 22,11 2,20"></polygon>
            </svg>
          </span>How do I...?
        </span>
      </a><ul role="group" aria-label="How do I...?" id="subtree--newspaper-curation-app-contributing-dev-howto-"><li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-howto/add-job-types/"
        >
        <span class="label">Add Job Types
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-howto/add-config-items/"
        >
        <span class="label">Add Configuration Settings
        </span>
      </a></li>
  <li role="none">
      <a
        role="treeitem"
        href="https://uoregon-libraries.github.io/newspaper-curation-app/contributing/dev-howto/add-privileges/"
        >
        <span class="label">Add Privileges / Roles
        </span>
      </a></li>
  </ul></li>
  </ul></li>
  </ul>
  </nav>
</div>


<main id="maincontent"><h1>Workflow</h1><p>This document details NCA&rsquo;s high-level workflow, hopefully to act as a guide to
generally understanding what goes on without necessarily worrying about all the
inner workings.</p>
<h2 id="setup">Setup</h2>
<p>See <a href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/server-setup/">Server Setup</a> for getting the software installed, and
<a href="https://uoregon-libraries.github.io/newspaper-curation-app/setup/services/">Services</a> for information about running the services NCA requires.</p>
<ol>
<li>Server is set up, directories mounted</li>
<li>Settings file (<code>/usr/local/nca/settings</code>, for example) is customized as needed</li>
<li>A dev or system administrator starts NCA in debug mode to create users</li>
<li>Title manager creates title records for all titles the app will see</li>
<li>MARC Org Code manager creates awardee codes NCA will need to know about</li>
</ol>
<h2 id="uploads">Uploads</h2>
<h3 id="pdf-sftp-born-digital">PDF SFTP (Born Digital)</h3>
<ol>
<li>Publishers upload PDF issues routinely to your servers
<ul>
<li>Uploads either go directly into NCA&rsquo;s SFTP folder, or a script can be built to move them</li>
<li><a href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/upload-specs/">See our detailed folder and filename specs</a></li>
</ul>
</li>
<li>Uploaded issues are individually verified and queued by a workflow manager using the &ldquo;Uploaded Issues&rdquo; section of the NCA web app
<ul>
<li>(Or the bulk queue CLI script is run if issues are verified out-of-band or trusted implicitly)</li>
</ul>
</li>
<li>The job runner picks up queued issues:
<ul>
<li>Issues are pre-processed to ensure they can be read properly</li>
<li>Issues are split so there is exactly one PDF per page of the issue</li>
<li>Issues are then moved to the &ldquo;page review&rdquo; area for manual processing</li>
</ul>
</li>
<li>Somebody reviews issues in the page review area:
<ul>
<li>Files must be renamed to indicate the review is complete (e.g., &ldquo;seq-0001.pdf&rdquo; to &ldquo;0001.pdf&rdquo;)</li>
<li>Files may be reordered if necessary</li>
<li>If there are invalid PDFs, they may be deleted</li>
<li>If the &ldquo;issue&rdquo; actually contains two issues, the secondary issue&rsquo;s files should be removed and reuploaded in the correct folder</li>
<li><strong>If the entire issue is broken and needs to be removed from the system, developer involvement is necessary</strong></li>
</ul>
</li>
<li>After files are reordered:
<ul>
<li>They must not be touched for a while, to ensure renaming/manipulation is complete</li>
<li>The job runner moves the files out of the page review folder and into the internal folder structure</li>
<li>Derivatives are created so the issue has the expected ALTO XML and JP2 files</li>
</ul>
</li>
</ol>
<h3 id="tiffpdf-scans">TIFF/PDF Scans</h3>
<ol>
<li>Digital imaging personnel scan papers and run them through OCR to produce a TIFF and PDF file
<ul>
<li>We use Abbyy for scanning, and the output PDF works with NCA</li>
<li><a href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/upload-specs/">See our detailed folder and filename specs</a></li>
</ul>
</li>
<li>Issues&rsquo; PDFs and TIFFs are uploaded
<ul>
<li>Uploads either go directly into NCA&rsquo;s scans folder, or a script can be built to move them</li>
</ul>
</li>
<li>The job runner automatically searches the scans folder for issues ready to move into the workflow:
<ul>
<li>They must not be touched for a while, to ensure all manipulation is complete</li>
<li>The job runner moves the files out of the scans folder and into the internal folder structure</li>
<li>Derivatives are created so the issue has the expected ALTO XML and JP2 files
<ul>
<li>In the case of scans, the JP2 is built from the TIFF, not the PDF</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="preparing-issues-for-batching">Preparing Issues for Batching</h2>
<p>After issues have been moved to the internal folders, and have had derivatives
generated, the workflow is the same regardless of the source:</p>
<ol>
<li>An issue curator enters metadata for the issue and queues it for review</li>
<li>An issue reviewer validates the metadata and rejects it or approves it</li>
<li>Once metadata is entered and approved, the issue has its final derivative
generated (METS XML) and awaits batching</li>
<li>When enough issues are ready, there are two ways to generate batches:
<ul>
<li>A dev can use the <code>queue-batches</code> command, generating batches for all
issues which are ready.</li>
<li>Somebody with the &ldquo;batch builder&rdquo; role can visit NCA&rsquo;s &ldquo;Create Batches&rdquo;
page and choose which MOCs should have issues batched.</li>
</ul>
</li>
<li>Batches will be put into the configured <code>BATCH_OUTPUT_PATH</code>, and required
files (e.g., not TIFFs) will be synced to production (as configured via
<code>BATCH_PRODUCTION_PATH</code>).</li>
<li>NCA will call out to the configured ONI Agent on staging to load the batch.
Once the ONI job is done, the batch will be marked ready for QC.</li>
<li>A batch reviewer does quality control on the staging server, verifying the
batch&rsquo;s issues look good
<ul>
<li>If all is well, batch reviewer marks the issue as ready for production</li>
<li>If not, they reject the batch and can then get individual issues pulled
out to be re-curated or rejected from NCA entirely. The remaining issues
are put into a new batch which is then rebuilt and sent to staging
(repeating steps 5 and 6).</li>
</ul>
</li>
<li>Batches that are ready for production get loaded to prod by the production
ONI Agent, and get flagged &ldquo;live&rdquo; when the agent reports the job as complete.</li>
<li>NCA moves the batch files to the configured <code>BATCH_ARCHIVE_PATH</code>.</li>
<li>Once the batch can be confirmed as fully archived, a batch loader flags it
as archived.</li>
<li>Somebody with command-line access to NCA will run <code>delete-live-done-issues</code>
(or set up a cron job) to clean unneeded files from NCA that are part of
archived batches. It only deletes files when a batch is at least four weeks
past its archive date to ensure any final problems can be handled.</li>
</ol>
<nav class="pagination" aria-label="Pagination">

  <a class="nav nav-prev" href="https://uoregon-libraries.github.io/newspaper-curation-app/specs/upload-specs/">← Prev - Uploads: Folder and File Specs</a>

  <a class="nav nav-next" href="https://uoregon-libraries.github.io/newspaper-curation-app/workflow/technical/">Next - Technical Details →</a></nav>
<footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>.
</footer>
      </main>
    </div>

  </div>
</body>
</html>
